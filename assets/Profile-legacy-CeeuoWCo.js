System.register(["./index-legacy-CxUkax4S.js","./datetime-legacy-BqGHtClD.js"],(function(e,t){"use strict";var a,s,i,o,n,l,r,c,d,u,p,m,g,w,f,h,b,v,y,x,k,L,A,O,S,C,D,E;return{setters:[e=>{a=e.a,s=e.T,i=e.c,o=e.l,n=e.P,l=e.f,r=e.ad,c=e.ae,d=e.i,u=e.af,p=e.a2,m=e.V,g=e.u,w=e._,f=e.g,h=e.w,b=e.r,v=e.o,y=e.h,x=e.m,k=e.B,L=e.Z,A=e.t,O=e.F,S=e.C,C=e.k},e=>{D=e.c,E=e.s}],execute:function(){var t=document.createElement("style");t.textContent=".text-label[data-v-bdf24889]{width:40%!important}\n",document.head.appendChild(t);const _=a({components:{IonPage:i,IonContent:s},data:()=>({userinfo:{},location:[],showBtn:!1,procLog:g()}),computed:{initialApproverName(){const e=this.userinfo;return Boolean(e.initialApproverName)?e.initialApproverName.split("|"):[]},finalApproverName(){const e=this.userinfo;return Boolean(e.finalApproverName)?e.finalApproverName.split("|"):[]}},async ionViewWillEnter(){const{value:e}=await n.get({key:"userinfo"});this.userinfo=JSON.parse(e||""),await this.getRegisteredLocation()},methods:{async getRegisteredLocation(){if("web"==this.platform){const{data:e}=await this.$api.getAllowedLocation({method:"post",data:{username:this.userinfo.username}});this.location=e?e.allowed_location:[],this.showBtn=Boolean(e.allowed_location.length<parseInt(this.userinfo.noOfLocations))}else{const e="SELECT * FROM allowed_locations",t=await this.procLog.selectQuery(e);t&&t.length>=0&&(this.location=t,this.showBtn=Boolean(t.length<parseInt(this.userinfo.noOfLocations)))}},async getLocation(e){const t=`https://nominatim.openstreetmap.org/reverse?lat=${e.latitude}&lon=${e.longitude}&format=json`,{data:a}=await m.request({method:"GET",url:t,headers:{"User-Agent":"spott/1.2.30 (misadtdevmail@gmail.com)",Accept:"application/json"}});return a.display_name},async calibrate(){if(d.value){const t=await o.create({message:"Getting location details, please wait..",translucent:!0,spinner:"lines"});if(this.location.length<parseInt(this.userinfo.noOfLocations))if("web"==this.platform){const e=await o.create({message:"Fetching location..",translucent:!0,spinner:"lines"});e.present(),navigator.geolocation.getCurrentPosition((async a=>{const{coords:s}=a;if(Boolean(s)){await e.dismiss(),t.present();const{latitude:s,longitude:i}=a.coords,o=await this.getLocation({latitude:s,longitude:i});if(o){await t.dismiss();const e=await l.create({header:"Fetch location successful!",subHeader:"Do you want to register this location?",message:o,backdropDismiss:!1,buttons:[{text:"Cancel",role:"cancel"},{text:"Register",handler:async()=>{await this.registerLocation({latitude:s,longitude:i,description:o})}}]});await e.present()}else{await t.dismiss();const e=await l.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{const e=await l.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}),(async e=>{if(1==e.code){const e=await l.create({header:"System Alert!",message:"SPOTT location permission is restricted.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}else{const e=await l.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}))}else try{if(await D(),E.value&&(await u(),Boolean(p.value)&&Object.keys(p.value).length>0)){const e=p.value;if(await t.present(),Math.round(e.coords.accuracy)<=30){const a=await this.getLocation(e.coords);if(a){e.coords.description=a,await t.dismiss();const s=await l.create({header:"Fetch location successful!",subHeader:"Do you want to register this location?",message:a,backdropDismiss:!1,buttons:[{text:"Cancel",role:"cancel"},{text:"Register",handler:async()=>{await this.registerLocation(e.coords)}}]});await s.present()}else{await t.dismiss();const e=await l.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{await t.dismiss();const e=await l.create({header:"System Alert!",message:"Failed to obtain an accurate location. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}}catch(e){await t.dismiss(),alert(e)}else{const e=await l.create({header:"System Alert!",message:"Maximum allowed location is reached.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{const e=await l.create({header:"System Alert!",message:"Please ensure you have a stable internet connection.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}},async registerLocation(e){if(d.value){const a=await o.create({message:"Registering location to the server, please wait...",translucent:!0,spinner:"lines"});a.present();try{const{data:t}=await this.$api.registerLocation({method:"post",data:{username:this.userinfo.username,longitude:e.longitude,latitude:e.latitude,description:e.description}});if(t)if("web"==this.platform)await a.dismiss(),await this.getRegisteredLocation();else{const t="INSERT INTO allowed_locations (username,longitude,latitude,description) VALUES (?,?,?,?)",s=[this.userinfo.username,e.longitude,e.latitude,e.description],i=await this.procLog.runQuery(t,s);null!=i&&i.lastId&&(await a.dismiss(),await this.getRegisteredLocation())}else{await a.dismiss();const e=await l.create({header:"System Alert!",message:"Location already registered, location must be unique.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}catch(t){await a.dismiss();const e=await l.create({header:"System Alert!",message:"Server unreachable, failed to register location.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{const e=await l.create({header:"System Alert!",message:"Please ensure you have a stable internet connection.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}},async logout(){const e=await o.create({message:"Logging out, please wait..",translucent:!0,spinner:"lines"});await e.present();try{if("web"==this.platform)await n.clear(),this.$router.push({path:"/login"});else{const e=await this.procLog.selectQuery("SELECT * from attlogs WHERE status = 0 ORDER BY id ASC");if(null!=e&&e.length){const e=await l.create({header:"System Alert!",message:"Offline logs must be uploaded first before you can log out from this device.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}else{const e=new r(c);(await e.isConnection("spottdb",!1)).result&&await e.closeConnection("spottdb",!1),await c.deleteDatabase({database:"spottdb"}),await n.clear(),this.$router.push({path:"/login"})}}}catch(t){alert(t)}finally{await e.dismiss()}}}}),F={class:"pt-2"},I={class:"d-block"},N={class:"d-block"},R={class:"d-block"},M={class:"text-center pb-4 px-4 pt-0 mt-2"},T={class:"d-flex text-wrap"},B={class:"font-weight-regular"},P={class:"d-flex text-wrap"},$={class:"font-weight-regular"},j={class:"d-flex text-wrap"},U={class:"font-weight-regular"},V={class:"d-flex text-wrap"},z={class:"font-weight-regular"},G={class:"d-flex text-wrap"},H={class:"font-weight-regular"},q={class:"text-center pb-4 px-4 pt-0 mt-2"},Q={class:"d-flex text-wrap"},W={class:"font-weight-regular"},J={class:"d-flex text-wrap"},Y={class:"font-weight-regular"},Z={class:"d-flex text-wrap"},K={class:"font-weight-regular"},X={class:"d-flex text-wrap"},ee={class:"font-weight-regular"},te={key:0,class:"d-flex text-wrap"},ae={class:"font-weight-regular"},se={key:0,class:"text-center pb-4 px-4 pt-0 mt-2"},ie={key:0},oe={class:"text-wrap mt-5"},ne={class:"font-weight-regular mb-5"},le={class:"mt-5"};e("default",w(_,[["render",function(e,t,a,s,i,o){const n=b("v-img"),l=b("v-card-title"),r=b("v-card"),c=b("v-btn"),d=b("v-icon"),u=b("v-container"),p=b("ion-content"),m=b("ion-page");return v(),f(m,null,{default:h((()=>[y(p,null,{default:h((()=>[y(u,{fluid:"",class:"mx-auto px-3",width:"web"!=e.platform||e.isMobile?"":"50%"},{default:h((()=>[y(r,{elevation:"0",color:"blue-grey-darken-4",class:"mx-auto rounded-lg"},{default:h((()=>[x("div",F,[y(n,{src:"/user.png","max-width":"120",class:"rounded-circle mx-auto"})]),y(l,{class:"text-center text-overline pb-5 text-wrap",style:{"font-size":"18px !important"}},{default:h((()=>[x("span",I,A(e.userinfo.EMPNUMB),1),x("span",N,A(e.userinfo.fullName),1),x("span",R,A(e.userinfo.posdesc),1)])),_:1})])),_:1}),x("fieldset",M,[t[7]||(t[7]=x("legend",{class:"text-overline font-weight-medium",style:{"font-size":"16px !important"}},"Employment Information",-1)),x("div",T,[t[2]||(t[2]=x("div",{class:"text-label font-weight-bold text-start"},"Company:",-1)),x("div",B,A(e.userinfo.cmpname),1)]),x("div",P,[t[3]||(t[3]=x("div",{class:"text-label font-weight-bold text-start"},"Department:",-1)),x("div",$,A(e.userinfo.department),1)]),x("div",j,[t[4]||(t[4]=x("div",{class:"text-label font-weight-bold text-start"},"Shift Schedule:",-1)),x("div",U,A(e.userinfo.EMPSHFT)+" - ("+A(e.userinfo.TIME_IN)+" - "+A(e.userinfo.TIME_OUT)+")",1)]),x("div",V,[t[5]||(t[5]=x("div",{class:"text-label font-weight-bold text-start"},"Restday Code:",-1)),x("div",z,A(e.userinfo.EMVRDCD),1)]),x("div",G,[t[6]||(t[6]=x("div",{class:"text-label font-weight-bold text-start"},"Base Location:",-1)),x("div",H,A(e.userinfo.EMVLCCD),1)])]),x("fieldset",q,[t[13]||(t[13]=x("legend",{class:"text-overline font-weight-medium",style:{"font-size":"16px !important"}},"SPOTT CONFIGURATION",-1)),x("div",Q,[t[8]||(t[8]=x("div",{class:"text-label font-weight-bold text-start"},"Image Capture:",-1)),x("div",W,A(1==e.userinfo.imageCapture?"Required":"Not needed"),1)]),x("div",J,[t[9]||(t[9]=x("div",{class:"text-label font-weight-bold text-start"},"Geo Fence Mode:",-1)),x("div",Y,A(1==e.userinfo.geoFenceMode?"Enabled":"Disabled"),1)]),x("div",Z,[t[10]||(t[10]=x("div",{class:"text-label font-weight-bold text-start"},"Initial Approver:",-1)),x("div",K,[(v(!0),k(O,null,S(e.initialApproverName,(e=>(v(),k("div",null,A(e),1)))),256))])]),x("div",X,[t[11]||(t[11]=x("div",{class:"text-label font-weight-bold text-start"},"Final Approver:",-1)),x("div",ee,[(v(!0),k(O,null,S(e.finalApproverName,(e=>(v(),k("div",null,A(e),1)))),256))])]),1==e.userinfo.geoFenceMode?(v(),k("div",te,[t[12]||(t[12]=x("div",{class:"text-label font-weight-bold text-start"},"Max allowed location:",-1)),x("div",ae,A(e.userinfo.noOfLocations),1)])):L("",!0)]),1==e.userinfo.geoFenceMode?(v(),k("fieldset",se,[t[15]||(t[15]=x("legend",{class:"text-overline font-weight-medium",style:{"font-size":"16px !important"}},"Registered Location",-1)),e.showBtn?(v(),k("div",ie,[y(c,{color:"primary",onClick:t[0]||(t[0]=t=>e.calibrate())},{default:h((()=>t[14]||(t[14]=[C("Calibrate Location")]))),_:1})])):L("",!0),x("div",oe,[(v(!0),k(O,null,S(e.location,(e=>(v(),k("div",ne,A(e.description),1)))),256))])])):L("",!0),x("div",le,[y(c,{block:"",color:"secondary",onClick:t[1]||(t[1]=t=>e.logout())},{default:h((()=>[y(d,null,{default:h((()=>t[16]||(t[16]=[C("mdi-logout-variant")]))),_:1}),t[17]||(t[17]=C(" Logout "))])),_:1})])])),_:1},8,["width"])])),_:1})])),_:1})}],["__scopeId","data-v-bdf24889"]]))}}}));
