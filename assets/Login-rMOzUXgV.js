import{d as q,a as N,I as z,b as L,c as M,l as U,i as T,e as B,s as D,D as b,f as E,u as S,P as k,_ as R,g as G,w as _,r as w,o as J,h as y,j as W,k as O,m as Y,t as Z}from"./index-B4PYElqd.js";import{g as K}from"./_commonjsHelpers-CqkleIqs.js";const Q=q("rules",{state:()=>({rules:{required:a=>!!a||"Field is required"}})});var $={exports:{}},A={exports:{}};(function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f={rotl:function(i,c){return i<<c|i>>>32-c},rotr:function(i,c){return i<<32-c|i>>>c},endian:function(i){if(i.constructor==Number)return f.rotl(i,8)&16711935|f.rotl(i,24)&4278255360;for(var c=0;c<i.length;c++)i[c]=f.endian(i[c]);return i},randomBytes:function(i){for(var c=[];i>0;i--)c.push(Math.floor(Math.random()*256));return c},bytesToWords:function(i){for(var c=[],u=0,l=0;u<i.length;u++,l+=8)c[l>>>5]|=i[u]<<24-l%32;return c},wordsToBytes:function(i){for(var c=[],u=0;u<i.length*32;u+=8)c.push(i[u>>>5]>>>24-u%32&255);return c},bytesToHex:function(i){for(var c=[],u=0;u<i.length;u++)c.push((i[u]>>>4).toString(16)),c.push((i[u]&15).toString(16));return c.join("")},hexToBytes:function(i){for(var c=[],u=0;u<i.length;u+=2)c.push(parseInt(i.substr(u,2),16));return c},bytesToBase64:function(i){for(var c=[],u=0;u<i.length;u+=3)for(var l=i[u]<<16|i[u+1]<<8|i[u+2],d=0;d<4;d++)u*8+d*6<=i.length*8?c.push(a.charAt(l>>>6*(3-d)&63)):c.push("=");return c.join("")},base64ToBytes:function(i){i=i.replace(/[^A-Z0-9+\/]/ig,"");for(var c=[],u=0,l=0;u<i.length;l=++u%4)l!=0&&c.push((a.indexOf(i.charAt(u-1))&Math.pow(2,-2*l+8)-1)<<l*2|a.indexOf(i.charAt(u))>>>6-l*2);return c}};A.exports=f})();var X=A.exports,C={utf8:{stringToBytes:function(a){return C.bin.stringToBytes(unescape(encodeURIComponent(a)))},bytesToString:function(a){return decodeURIComponent(escape(C.bin.bytesToString(a)))}},bin:{stringToBytes:function(a){for(var f=[],i=0;i<a.length;i++)f.push(a.charCodeAt(i)&255);return f},bytesToString:function(a){for(var f=[],i=0;i<a.length;i++)f.push(String.fromCharCode(a[i]));return f.join("")}}},P=C;/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var j=function(a){return a!=null&&(I(a)||tt(a)||!!a._isBuffer)};function I(a){return!!a.constructor&&typeof a.constructor.isBuffer=="function"&&a.constructor.isBuffer(a)}function tt(a){return typeof a.readFloatLE=="function"&&typeof a.slice=="function"&&I(a.slice(0,0))}(function(){var a=X,f=P.utf8,i=j,c=P.bin,u=function(l,d){l.constructor==String?d&&d.encoding==="binary"?l=c.stringToBytes(l):l=f.stringToBytes(l):i(l)?l=Array.prototype.slice.call(l,0):!Array.isArray(l)&&l.constructor!==Uint8Array&&(l=l.toString());for(var t=a.bytesToWords(l),p=l.length*8,n=1732584193,e=-271733879,r=-1732584194,o=271733878,s=0;s<t.length;s++)t[s]=(t[s]<<8|t[s]>>>24)&16711935|(t[s]<<24|t[s]>>>8)&4278255360;t[p>>>5]|=128<<p%32,t[(p+64>>>9<<4)+14]=p;for(var m=u._ff,g=u._gg,h=u._hh,v=u._ii,s=0;s<t.length;s+=16){var F=n,x=e,H=r,V=o;n=m(n,e,r,o,t[s+0],7,-680876936),o=m(o,n,e,r,t[s+1],12,-389564586),r=m(r,o,n,e,t[s+2],17,606105819),e=m(e,r,o,n,t[s+3],22,-1044525330),n=m(n,e,r,o,t[s+4],7,-176418897),o=m(o,n,e,r,t[s+5],12,1200080426),r=m(r,o,n,e,t[s+6],17,-1473231341),e=m(e,r,o,n,t[s+7],22,-45705983),n=m(n,e,r,o,t[s+8],7,1770035416),o=m(o,n,e,r,t[s+9],12,-1958414417),r=m(r,o,n,e,t[s+10],17,-42063),e=m(e,r,o,n,t[s+11],22,-1990404162),n=m(n,e,r,o,t[s+12],7,1804603682),o=m(o,n,e,r,t[s+13],12,-40341101),r=m(r,o,n,e,t[s+14],17,-1502002290),e=m(e,r,o,n,t[s+15],22,1236535329),n=g(n,e,r,o,t[s+1],5,-165796510),o=g(o,n,e,r,t[s+6],9,-1069501632),r=g(r,o,n,e,t[s+11],14,643717713),e=g(e,r,o,n,t[s+0],20,-373897302),n=g(n,e,r,o,t[s+5],5,-701558691),o=g(o,n,e,r,t[s+10],9,38016083),r=g(r,o,n,e,t[s+15],14,-660478335),e=g(e,r,o,n,t[s+4],20,-405537848),n=g(n,e,r,o,t[s+9],5,568446438),o=g(o,n,e,r,t[s+14],9,-1019803690),r=g(r,o,n,e,t[s+3],14,-187363961),e=g(e,r,o,n,t[s+8],20,1163531501),n=g(n,e,r,o,t[s+13],5,-1444681467),o=g(o,n,e,r,t[s+2],9,-51403784),r=g(r,o,n,e,t[s+7],14,1735328473),e=g(e,r,o,n,t[s+12],20,-1926607734),n=h(n,e,r,o,t[s+5],4,-378558),o=h(o,n,e,r,t[s+8],11,-2022574463),r=h(r,o,n,e,t[s+11],16,1839030562),e=h(e,r,o,n,t[s+14],23,-35309556),n=h(n,e,r,o,t[s+1],4,-1530992060),o=h(o,n,e,r,t[s+4],11,1272893353),r=h(r,o,n,e,t[s+7],16,-155497632),e=h(e,r,o,n,t[s+10],23,-1094730640),n=h(n,e,r,o,t[s+13],4,681279174),o=h(o,n,e,r,t[s+0],11,-358537222),r=h(r,o,n,e,t[s+3],16,-722521979),e=h(e,r,o,n,t[s+6],23,76029189),n=h(n,e,r,o,t[s+9],4,-640364487),o=h(o,n,e,r,t[s+12],11,-421815835),r=h(r,o,n,e,t[s+15],16,530742520),e=h(e,r,o,n,t[s+2],23,-995338651),n=v(n,e,r,o,t[s+0],6,-198630844),o=v(o,n,e,r,t[s+7],10,1126891415),r=v(r,o,n,e,t[s+14],15,-1416354905),e=v(e,r,o,n,t[s+5],21,-57434055),n=v(n,e,r,o,t[s+12],6,1700485571),o=v(o,n,e,r,t[s+3],10,-1894986606),r=v(r,o,n,e,t[s+10],15,-1051523),e=v(e,r,o,n,t[s+1],21,-2054922799),n=v(n,e,r,o,t[s+8],6,1873313359),o=v(o,n,e,r,t[s+15],10,-30611744),r=v(r,o,n,e,t[s+6],15,-1560198380),e=v(e,r,o,n,t[s+13],21,1309151649),n=v(n,e,r,o,t[s+4],6,-145523070),o=v(o,n,e,r,t[s+11],10,-1120210379),r=v(r,o,n,e,t[s+2],15,718787259),e=v(e,r,o,n,t[s+9],21,-343485551),n=n+F>>>0,e=e+x>>>0,r=r+H>>>0,o=o+V>>>0}return a.endian([n,e,r,o])};u._ff=function(l,d,t,p,n,e,r){var o=l+(d&t|~d&p)+(n>>>0)+r;return(o<<e|o>>>32-e)+d},u._gg=function(l,d,t,p,n,e,r){var o=l+(d&p|t&~p)+(n>>>0)+r;return(o<<e|o>>>32-e)+d},u._hh=function(l,d,t,p,n,e,r){var o=l+(d^t^p)+(n>>>0)+r;return(o<<e|o>>>32-e)+d},u._ii=function(l,d,t,p,n,e,r){var o=l+(t^(d|~p))+(n>>>0)+r;return(o<<e|o>>>32-e)+d},u._blocksize=16,u._digestsize=16,$.exports=function(l,d){if(l==null)throw new Error("Illegal argument "+l);var t=a.wordsToBytes(u(l,d));return d&&d.asBytes?t:d&&d.asString?c.bytesToString(t):a.bytesToHex(t)}})();var et=$.exports;const ot=K(et),nt=N({components:{IonPage:M,IonFooter:L,IonTitle:z},data(){return{show:!1,rules:Q().rules.required,loading:!1,model:{username:null,password:null},version:"1.2.30",dataSync:D()}},methods:{async login(){const a=await this.$refs.form.validate(),f=await U.create({message:"Logging in, please wait..",translucent:!0,spinner:"lines"});if(a.valid){this.loading=!0;const i=async c=>{const u=await b.getInfo(),l=await b.getId(),d=ot(c.password);c.platform=this.platform,c.model=(u==null?void 0:u.model)==null||(l==null?void 0:l.identifier)==null?null:"".concat(u==null?void 0:u.model,"=>").concat(l==null?void 0:l.identifier),c.deviceID=(l==null?void 0:l.identifier)==null?null:l==null?void 0:l.identifier,await f.present();try{const{data:t}=await this.$api.login({method:"post",data:{...c,password:d}});if((t==null?void 0:t.status)==3)await f.dismiss(),B.warning("The system could not recognize your user credentials.",{autoClose:1500,position:this.platform=="web"?"top-right":"top-center",closeButton:!1,hideProgressBar:!0,transition:"slide",pauseOnHover:!1,toastId:"unique-toast-id",closeOnClick:!1});else if((t==null?void 0:t.status)==2)await f.dismiss(),B.warning("You cannot register any more devices. Maximum limit reached.",{autoClose:1500,position:this.platform=="web"?"top-right":"top-center",closeButton:!1,hideProgressBar:!0,transition:"slide",pauseOnHover:!1,toastId:"unique-toast-id",closeOnClick:!1});else if(t!=null&&t.isNewDevice){await f.dismiss();const p=await E.create({header:"System Notice",subHeader:"Device registration",cssClass:"my-custom-alert",message:"Device successfully registered to server. You will only be able to access your account from registered devices.",buttons:[{text:"Proceed",role:"confirm"}],backdropDismiss:!1});await p.present();const{role:n}=await p.onDidDismiss();n=="confirm"?(await S().dbInit(),await k.set({key:"userinfo",value:JSON.stringify(t.userinfo)}),this.$router.replace({path:"/index/home"}),await this.dataSync.syncAll()):(this.loading=!1,await f.dismiss())}else await S().dbInit(),await k.set({key:"userinfo",value:JSON.stringify(t.userinfo)}),await f.dismiss(),this.$router.replace({path:"/index/home"}),await this.dataSync.syncAll()}catch(t){await f.dismiss(),B.error("An error occurred while logging in.",{autoClose:1500,position:this.platform=="web"?"top-right":"top-center",closeButton:!1,hideProgressBar:!0,transition:"slide",pauseOnHover:!1,toastId:"unique-toast-id",closeOnClick:!1})}};this.platform=="web"?T.value?(this.loading=!1,await i(this.model)):B.warning("Cannot connect to server, Please check your internet connection.",{autoClose:1e3,closeButton:!1,hideProgressBar:!0,transition:"slide",pauseOnHover:!1,toastId:"unique-toast-id",position:this.platform=="web"?"top-right":"top-center",closeOnClick:!1}):T.value?(this.loading=!1,await i(this.model)):(B.warning("Cannot connect to server, Please check your internet connection.",{autoClose:1e3,closeButton:!1,hideProgressBar:!0,transition:"slide",pauseOnHover:!1,toastId:"unique-toast-id",position:this.platform=="web"?"top-right":"top-center",closeOnClick:!1}),this.loading=!1)}}}}),rt={class:"vlabel text-overline font-weight-bold text-white"};function st(a,f,i,c,u,l){const d=w("v-img"),t=w("v-card-title"),p=w("v-text-field"),n=w("v-card-text"),e=w("v-icon"),r=w("v-btn"),o=w("v-card-actions"),s=w("v-form"),m=w("v-card"),g=w("v-container"),h=w("ion-title"),v=w("ion-footer"),F=w("ion-page");return J(),G(F,{class:"backdrop"},{default:_(()=>[y(g,{class:"mx-auto"},{default:_(()=>[y(m,{tile:"",width:a.platform=="web"&&!a.isMobile?"40%":"",class:"mx-auto my-auto overflow-y-hidden rounded bg-transparent",flat:""},{default:_(()=>[y(s,{ref:"form","lazy-validation":"",id:"login-form",onSubmit:f[3]||(f[3]=W(x=>a.login(),["prevent"]))},{default:_(()=>[y(t,{class:"text-center pt-8 pb-6"},{default:_(()=>[y(d,{src:"logo_no_bg.png","aspect-ratio":a.platform=="web"?2:1.5},null,8,["aspect-ratio"]),f[4]||(f[4]=O("span",{class:"text-wrap text-overline text-white",style:{"font-size":"16px !important"}}," Sterling Paper Online Time Tracking ",-1))]),_:1}),y(n,null,{default:_(()=>[y(p,{modelValue:a.model.username,"onUpdate:modelValue":f[0]||(f[0]=x=>a.model.username=x),variant:"outlined",density:"comfortable",label:"Username",class:"px-2 pb-3 font-weight-medium custom-label text-white",rules:[a.rules],"prepend-inner-icon":"mdi-account",color:"white"},null,8,["modelValue","rules"]),y(p,{modelValue:a.model.password,"onUpdate:modelValue":f[1]||(f[1]=x=>a.model.password=x),variant:"outlined",density:"comfortable",label:"Password",class:"px-2 font-weight-medium custom-label text-white",rules:[a.rules],type:a.show?"text":"password","prepend-inner-icon":"mdi-key","append-inner-icon":a.show?"mdi-eye":"mdi-eye-off","onClick:appendInner":f[2]||(f[2]=x=>a.show=!a.show),color:"white"},null,8,["modelValue","rules","type","append-inner-icon"])]),_:1}),y(o,{class:"pa-2 mb-3 px-5 ma-0"},{default:_(()=>[y(r,{form:"login-form",type:"submit",class:"px-5",color:"btn-primary",variant:"flat",block:"",size:"large",loading:a.loading},{default:_(()=>[f[5]||(f[5]=Y(" Login ")),y(e,{icon:"mdi-login"})]),_:1},8,["loading"])]),_:1})]),_:1},512)]),_:1},8,["width"])]),_:1}),y(v,null,{default:_(()=>[y(h,null,{default:_(()=>[O("span",rt,"Version "+Z(a.version),1)]),_:1})]),_:1})]),_:1})}const lt=R(nt,[["render",st],["__scopeId","data-v-60bb84df"]]);export{lt as default};
