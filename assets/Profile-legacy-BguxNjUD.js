System.register(["./index-legacy-4C-Rd9M0.js","./datetime-legacy-DJaFH3aU.js"],(function(e,t){"use strict";var a,s,i,o,n,l,r,c,d,u,p,m,g,w,f,h,b,v,y,x,k,L,A,O,S,C,D,I,E,R,_;return{setters:[e=>{a=e.a,s=e.S,i=e.Q,o=e.I,n=e.R,l=e.c,r=e.l,c=e.f,d=e.ae,u=e.af,p=e.P,m=e.i,g=e.ag,w=e.a2,f=e.U,h=e.u,b=e._,v=e.g,y=e.w,x=e.r,k=e.o,L=e.h,A=e.k,O=e.Y,S=e.C,C=e.t,D=e.Z,I=e.ac,E=e.m},e=>{R=e.c,_=e.s}],execute:function(){var t=document.createElement("style");t.textContent=".text-label[data-v-f5305682]{width:40%!important}\n",document.head.appendChild(t);const N=a({components:{IonPage:l,IonHeader:n,IonTitle:o,IonToolbar:i,IonContent:s},data:()=>({userinfo:{},location:[],showBtn:!1,procLog:h()}),computed:{initialApproverName(){const e=this.userinfo;return Boolean(e.initialApproverName)?e.initialApproverName.split("|"):[]},finalApproverName(){const e=this.userinfo;return Boolean(e.finalApproverName)?e.finalApproverName.split("|"):[]}},async ionViewWillEnter(){const{value:e}=await p.get({key:"userinfo"});this.userinfo=JSON.parse(e||""),await this.getRegisteredLocation()},methods:{async getRegisteredLocation(){if("web"==this.platform){const{data:e}=await this.$api.getAllowedLocation({method:"post",data:{username:this.userinfo.username}});this.location=e?e.allowed_location:[],this.showBtn=Boolean(e.allowed_location.length<parseInt(this.userinfo.noOfLocations))}else{const e="SELECT * FROM allowed_locations",t=await this.procLog.selectQuery(e);t&&t.length>0&&(this.location=t,this.showBtn=Boolean(t.length<parseInt(this.userinfo.noOfLocations)))}},async getLocation(e){const t=`https://nominatim.openstreetmap.org/reverse?lat=${e.latitude}&lon=${e.longitude}&format=json`,{data:a}=await f.request({method:"GET",url:t,headers:{"User-Agent":"spott/1.2.30 (misadtdevmail@gmail.com)",Accept:"application/json"}});return a.display_name},async calibrate(){if(m.value){const t=await r.create({message:"Getting location details, please wait..",translucent:!0,spinner:"lines"});if(this.location.length<parseInt(this.userinfo.noOfLocations))if("web"==this.platform){const e=await r.create({message:"Fetching location..",translucent:!0,spinner:"lines"});e.present(),navigator.geolocation.getCurrentPosition((async a=>{const{coords:s}=a;if(Boolean(s)){await e.dismiss(),t.present();const{latitude:s,longitude:i}=a.coords,o=await this.getLocation({latitude:s,longitude:i});if(o){await t.dismiss();const e=await c.create({header:"Fetch location successful!",subHeader:"Do you want to register this location?",message:o,backdropDismiss:!1,buttons:[{text:"Cancel",role:"cancel"},{text:"Register",handler:async()=>{await this.registerLocation({latitude:s,longitude:i,description:o})}}]});await e.present()}else{await t.dismiss();const e=await c.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{const e=await c.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}),(async e=>{if(1==e.code){const e=await c.create({header:"System Alert!",message:"SPOTT location permission is restricted.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}else{const e=await c.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}))}else try{if(await R(),_.value&&(await g(),Boolean(w.value)&&Object.keys(w.value).length>0)){const e=w.value;if(await t.present(),Math.round(e.coords.accuracy)<=30){const a=await this.getLocation(e.coords);if(a){e.coords.description=a,await t.dismiss();const s=await c.create({header:"Fetch location successful!",subHeader:"Do you want to register this location?",message:a,backdropDismiss:!1,buttons:[{text:"Cancel",role:"cancel"},{text:"Register",handler:async()=>{await this.registerLocation(e.coords)}}]});await s.present()}else{await t.dismiss();const e=await c.create({header:"System Alert!",message:"Failed to obtain location description. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{await t.dismiss();const e=await c.create({header:"System Alert!",message:"Failed to obtain an accurate location. Please retry.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}}catch(e){await t.dismiss(),alert(e)}else{const e=await c.create({header:"System Alert!",message:"Maximum allowed location is reached.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{const e=await c.create({header:"System Alert!",message:"Please ensure you have a stable internet connection in order to calibrate your location.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}},async registerLocation(e){if(m.value){const a=await r.create({message:"Registering location to the server, please wait...",translucent:!0,spinner:"lines"});a.present();try{const{data:t}=await this.$api.registerLocation({method:"post",data:{username:this.userinfo.username,longitude:e.longitude,latitude:e.latitude,description:e.description}});if(t)if("web"==this.platform)await a.dismiss(),await this.getRegisteredLocation();else{const t="INSERT INTO allowed_locations (username,longitude,latitude,description) VALUES (?,?,?,?)",s=[this.userinfo.username,e.longitude,e.latitude,e.description],i=await this.procLog.runQuery(t,s);null!=i&&i.lastId&&(await a.dismiss(),await this.getRegisteredLocation())}else{await a.dismiss();const e=await c.create({header:"System Alert!",message:"Location already registered, location must be unique.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}catch(t){await a.dismiss();const e=await c.create({header:"System Alert!",message:"Server unreachable, failed to register location.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}}else{const e=await c.create({header:"System Alert!",message:"Internet connection is disconnected.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}},async logout(){const e=await r.create({message:"Logging out, please wait..",translucent:!0,spinner:"lines"});await e.present();try{const e=await this.procLog.selectQuery("SELECT * from attlogs WHERE status = 0 ORDER BY id ASC");if(null!=e&&e.length){const e=await c.create({header:"System Alert!",message:"Offline logs must be uploaded first before you can log out from this device.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}else{const e=new d(u);(await e.isConnection("spottdb",!1)).result&&await e.closeConnection("spottdb",!1),await u.deleteDatabase({database:"spottdb"}),await p.clear(),this.$router.push({path:"/login"})}}catch(t){alert(t)}finally{await e.dismiss()}}}}),F={class:"pt-2"},M={class:"d-block"},T={class:"d-block"},B={class:"d-block"},P={class:"text-center pb-4 px-4 pt-0 mt-2"},U={class:"d-flex text-wrap"},j={class:"font-weight-regular"},H={class:"d-flex text-wrap"},$={class:"font-weight-regular"},z={class:"d-flex text-wrap"},G={class:"font-weight-regular"},Q={class:"d-flex text-wrap"},V={class:"font-weight-regular"},q={class:"d-flex text-wrap"},W={class:"font-weight-regular"},Y={class:"text-center pb-4 px-4 pt-0 mt-2"},J={class:"d-flex text-wrap"},Z={class:"font-weight-regular"},K={class:"d-flex text-wrap"},X={class:"font-weight-regular"},ee={class:"d-flex text-wrap"},te={class:"font-weight-regular"},ae={class:"d-flex text-wrap"},se={class:"font-weight-regular"},ie={key:0,class:"d-flex text-wrap"},oe={class:"font-weight-regular"},ne={key:0,class:"text-center pb-4 px-4 pt-0 mt-2"},le={key:0},re={class:"text-wrap mt-5"},ce={class:"font-weight-regular mb-5"},de={class:"mt-5"};e("default",b(N,[["render",function(e,t,a,s,i,o){const n=x("v-img"),l=x("v-card-title"),r=x("v-card"),c=x("v-btn"),d=x("v-icon"),u=x("v-container"),p=x("ion-content"),m=x("ion-page");return k(),v(m,null,{default:y((()=>[L(p,null,{default:y((()=>[L(u,{fluid:"",class:"mx-auto px-3",width:"web"!=e.platform||e.isMobile?"":"50%"},{default:y((()=>[L(r,{elevation:"0",color:"blue-grey-darken-4",class:"mx-auto rounded-lg"},{default:y((()=>[A("div",F,[L(n,{src:"/user.png","max-width":"120",class:"rounded-circle mx-auto"})]),L(l,{class:"text-center text-overline pb-5 text-wrap",style:{"font-size":"18px !important"}},{default:y((()=>[A("span",M,C(e.userinfo.EMPNUMB),1),A("span",T,C(e.userinfo.fullName),1),A("span",B,C(e.userinfo.posdesc),1)])),_:1})])),_:1}),A("fieldset",P,[t[7]||(t[7]=A("legend",{class:"text-overline font-weight-medium",style:{"font-size":"16px !important"}},"Employment Information",-1)),A("div",U,[t[2]||(t[2]=A("div",{class:"text-label font-weight-bold text-start"},"Company:",-1)),A("div",j,C(e.userinfo.cmpname),1)]),A("div",H,[t[3]||(t[3]=A("div",{class:"text-label font-weight-bold text-start"},"Department:",-1)),A("div",$,C(e.userinfo.department),1)]),A("div",z,[t[4]||(t[4]=A("div",{class:"text-label font-weight-bold text-start"},"Shift Schedule:",-1)),A("div",G,C(e.userinfo.EMPSHFT)+" - ("+C(e.userinfo.TIME_IN)+" - "+C(e.userinfo.TIME_OUT)+")",1)]),A("div",Q,[t[5]||(t[5]=A("div",{class:"text-label font-weight-bold text-start"},"Restday Code:",-1)),A("div",V,C(e.userinfo.EMVRDCD),1)]),A("div",q,[t[6]||(t[6]=A("div",{class:"text-label font-weight-bold text-start"},"Base Location:",-1)),A("div",W,C(e.userinfo.EMVLCCD),1)])]),A("fieldset",Y,[t[13]||(t[13]=A("legend",{class:"text-overline font-weight-medium",style:{"font-size":"16px !important"}},"SPOTT CONFIGURATION",-1)),A("div",J,[t[8]||(t[8]=A("div",{class:"text-label font-weight-bold text-start"},"Image Capture:",-1)),A("div",Z,C(1==e.userinfo.imageCapture?"Required":"Not needed"),1)]),A("div",K,[t[9]||(t[9]=A("div",{class:"text-label font-weight-bold text-start"},"Geo Fence Mode:",-1)),A("div",X,C(1==e.userinfo.geoFenceMode?"Enabled":"Disabled"),1)]),A("div",ee,[t[10]||(t[10]=A("div",{class:"text-label font-weight-bold text-start"},"Initial Approver:",-1)),A("div",te,[(k(!0),O(D,null,I(e.initialApproverName,(e=>(k(),O("div",null,C(e),1)))),256))])]),A("div",ae,[t[11]||(t[11]=A("div",{class:"text-label font-weight-bold text-start"},"Final Approver:",-1)),A("div",se,[(k(!0),O(D,null,I(e.finalApproverName,(e=>(k(),O("div",null,C(e),1)))),256))])]),1==e.userinfo.geoFenceMode?(k(),O("div",ie,[t[12]||(t[12]=A("div",{class:"text-label font-weight-bold text-start"},"Max allowed location:",-1)),A("div",oe,C(e.userinfo.noOfLocations),1)])):S("",!0)]),1==e.userinfo.geoFenceMode?(k(),O("fieldset",ne,[t[15]||(t[15]=A("legend",{class:"text-overline font-weight-medium",style:{"font-size":"16px !important"}},"Registered Location",-1)),e.showBtn?(k(),O("div",le,[L(c,{color:"primary",onClick:t[0]||(t[0]=t=>e.calibrate())},{default:y((()=>t[14]||(t[14]=[E("Calibrate Location")]))),_:1})])):S("",!0),A("div",re,[(k(!0),O(D,null,I(e.location,(e=>(k(),O("div",ce,C(e.description),1)))),256))])])):S("",!0),A("div",de,[L(c,{block:"",color:"secondary",onClick:t[1]||(t[1]=t=>e.logout())},{default:y((()=>[L(d,null,{default:y((()=>t[16]||(t[16]=[E("mdi-logout-variant")]))),_:1}),t[17]||(t[17]=E(" Logout "))])),_:1})])])),_:1},8,["width"])])),_:1})])),_:1})}],["__scopeId","data-v-f5305682"]]))}}}));
