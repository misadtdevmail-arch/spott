System.register(["./index-legacy-D_rLb8Vd.js"],(function(e,t){"use strict";var a,l,n,s,o,i,d,r,u,c,m,p,f,g,h,v,w,y,x,b,_,D,k,Y,I,L,O,C,V,M,B,N,S;return{setters:[e=>{a=e.a,l=e.Q,n=e.O,s=e.N,o=e.ac,i=e.T,d=e.R,r=e.I,u=e.S,c=e.c,m=e.l,p=e.V,f=e.P,g=e.a1,h=e.X,v=e.i,w=e.f,y=e.Y,x=e._,b=e.g,_=e.w,D=e.r,k=e.o,Y=e.h,I=e.m,L=e.ab,O=e.k,C=e.B,V=e.F,M=e.C,B=e.t,N=e.Z,S=e.G}],execute:function(){var t=document.createElement("style");t.textContent=".tblheader[data-v-6fc99143]{background-color:#0d47a1;color:#fff}.label[data-v-6fc99143]{min-width:50px}\n",document.head.appendChild(t);const T=a({components:{IonPage:c,IonHeader:u,IonTitle:r,IonToolbar:d,IonContent:i,IonModal:o,IonItem:s,IonButton:n,IonButtons:l},data:()=>({menu:!1,dialog:{status:!1,src:null,data:null},date:[],logs:[],approvalLevel:[],moment:g,search:"",dtr:[],rawdtr:[],backHandler:null}),computed:{getDate(){let e=this.date;if(1==e.length)return g(e[0]).format("L");if(e.length>1){let t=e[0],a=e[e.length-1];return g(t).format("L")+" - "+g(a).format("L")}return this.setDefaultDate(),null},flogs(){let e=this.logs;if(this.approvalLevel.length>0&&(e=e.filter((e=>this.approvalLevel.includes(parseInt(e.approvalLevel))))),this.search){let t=this.search.trim();e=e.filter((e=>e.fullName.toLowerCase().includes(t.toLowerCase())))}return e.length>0&&(e=[...new Set(e.map((e=>{const{username:t,fullName:a}=e;return JSON.stringify({username:t,fullName:a})})))].map((e=>JSON.parse(e))),e.sort(((e,t)=>e.fullName.localeCompare(t.fullName)))),e}},async ionViewWillEnter(){this.setDefaultDate(),await this.getLogs(),y(200,(e=>{this.dialog.status?this.dialog.status=!1:e()}))},methods:{setDefaultDate(){const e=[];for(let t=15;t>=0;t--){const a=g().subtract(t,"days").format("L");e.push(a)}this.date=e},selectDate:async function(){this.date.length>1&&(await this.getLogs(),this.menu=!1)},async getLogs(){this.logs=[];const{value:e}=await f.get({key:"userinfo"}),t=JSON.parse(e||"");if(v.value){const e=await m.create({message:"Fetching attendance logs, please wait..",translucent:!0,spinner:"lines"});await e.present();try{const{data:a}=await this.$api.getLogs({method:"post",data:{username:t.username,initialApp:t.IAPP,finalApp:t.FAPP,deptListAccess:t.departmentAccess,from:g(this.date[0]).format("YYYYY-MM-DD"),to:g(this.date[this.date.length-1]).format("YYYYY-MM-DD")}});a.length>0&&(this.logs=a),await e.dismiss()}catch(a){await e.dismiss(),alert(a)}}else{const e=await w.create({header:"System Alert!",message:"Please ensure you have a stable internet connection.",backdropDismiss:!1,buttons:["Okay"]});await e.present()}},async close(){await h.dismiss()},async getDtr(e){const{value:t}=await f.get({key:"userinfo"}),a=JSON.parse(t||""),l=await m.create({message:"Fetching employee dtr..",translucent:!0,spinner:"lines"});try{await l.present();let{data:t}=await this.$api.getDtr({method:"post",data:{username:e,from:g(this.date[0]).format("YYYYY-MM-DD"),to:g(this.date[this.date.length-1]).format("YYYYY-MM-DD"),isLive:a.isLive}});if(t.length>0){1==t[0].trxmode&&t.splice(0,1);const e=t.filter((e=>0==e.trxmode)),a=t.filter((e=>1==e.trxmode)),l=e.map(((e,t)=>(null==a[t]?(e.trxOut=null,e.trxOutData={}):(e.trxOut=a[t].trxtime,e.trxOutData=a[t]),e)));this.dtr=[...new Set(e.map((e=>e.trxdate)))].map((e=>({date:e,data:l.filter((t=>t.trxdate==e))}))),this.dtr.sort(((e,t)=>t.date.localeCompare(e.date))),this.rawdtr=t}await l.dismiss()}catch(n){await l.dismiss(),alert(n)}},async viewImage(e){this.dialog.src=null,this.dialog.data=null;const t=await m.create({message:"Loading image, please wait..",translucent:!0,spinner:"lines"});await t.present();try{if(Boolean(e.pathname)){const{data:t}=await this.$api.viewFile({method:"post",data:{pathname:e.pathname}});t&&(this.dialog.src=t.replace(/^data:image\/\w+;base64,/,"").replace(/\\\//g,"/").replace(/\s/g,""))}if(Boolean(e.latitude)&&Boolean(e.longitude)){const{data:t}=await p.get({url:"https://nominatim.openstreetmap.org/reverse",params:{format:"json",lat:e.latitude,lon:e.longitude},headers:{"User-Agent":"spott/1.2.30 (misadtdevmail@gmail.com)",Accept:"application/json"}});e.display_name=t.display_name,this.dialog.data=e}}catch(a){throw await t.dismiss(),a}finally{await t.dismiss(),(Boolean(this.dialog.src)||Boolean(this.dialog.data))&&(this.dialog.status=!0)}}}}),A={width:"100%",border:"1",class:"text-center"},E={width:"20%"},P={class:"text-body-1"},R={class:"text-body-1"},U={border:"",width:"100%"},F={align:"center"},J={class:"text-center"},$={colspan:"2",class:"px-1"},j={key:1},H={class:"font-weight-bold"},z={class:"font-weight-medium"},G={class:"bg-transparent",colspan:"2"},Q={key:0,class:"ma-0",style:{height:"400px",position:"relative"}},W={key:1};e("default",x(T,[["render",function(e,t,a,l,n,s){const o=D("ion-title"),i=D("ion-toolbar"),d=D("ion-header"),r=D("v-text-field"),u=D("v-date-picker"),c=D("v-menu"),m=D("v-col"),p=D("v-btn"),f=D("v-btn-toggle"),g=D("ion-button"),h=D("ion-buttons"),v=D("v-expansion-panel-title"),w=D("v-icon"),y=D("v-expansion-panel-text"),x=D("v-expansion-panel"),T=D("v-expansion-panels"),X=D("v-container"),Z=D("ion-content"),q=D("ion-modal"),K=D("v-row"),ee=D("v-img"),te=D("v-card-text"),ae=D("v-card"),le=D("v-dialog"),ne=D("ion-page");return k(),b(ne,null,{default:_((()=>[Y(d,{collapse:"fade"},{default:_((()=>[Y(i,null,{default:_((()=>[Y(o,null,{default:_((()=>t[6]||(t[6]=[I("span",{class:"ml-4"},"DTR REPORT",-1)]))),_:1})])),_:1})])),_:1}),Y(Z,null,{default:_((()=>[Y(X,{fluid:"",class:"mx-auto px-3",width:"web"!=e.platform||e.isMobile?"":"50%"},{default:_((()=>[Y(K,{class:"pa-0 ma-0 mb-3"},{default:_((()=>[Y(m,{cols:"12",class:"pa-0 px-1 ma-0"},{default:_((()=>[Y(c,{modelValue:e.menu,"onUpdate:modelValue":t[2]||(t[2]=t=>e.menu=t),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"350",location:"center","open-on-click":!1,persistent:!Boolean(e.date.length>1)},{activator:_((({props:a})=>[Y(r,L({"model-value":e.getDate,label:"Select date range","prepend-inner-icon":"mdi-calendar-range",variant:"outlined",density:"compact",readonly:""},a,{class:"text-black font-weight-medium custom-label",onClick:t[0]||(t[0]=t=>e.menu=!0),"hide-details":""}),null,16,["model-value"])])),default:_((()=>[Y(u,{modelValue:e.date,"onUpdate:modelValue":[t[1]||(t[1]=t=>e.date=t),e.selectDate],multiple:"range",color:"blue-darken-4",max:e.moment().format("YYYY-MM-DD"),range:!0},null,8,["modelValue","max","onUpdate:modelValue"])])),_:1},8,["modelValue","persistent"])])),_:1}),Y(m,{cols:"12",class:"pa-0 px-1 ma-0 mt-2"},{default:_((()=>[Y(r,{modelValue:e.search,"onUpdate:modelValue":t[3]||(t[3]=t=>e.search=t),label:"Search employee",variant:"outlined",density:"compact","hide-details":"",placeholder:"Enter employee name",clearable:""},null,8,["modelValue"])])),_:1}),Y(m,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:_((()=>[Y(f,{modelValue:e.approvalLevel,"onUpdate:modelValue":t[4]||(t[4]=t=>e.approvalLevel=t),multiple:"",density:"compact",color:"#0D47A1",border:""},{default:_((()=>[Y(p,{value:1},{default:_((()=>t[7]||(t[7]=[O("Initial")]))),_:1}),Y(p,{value:2},{default:_((()=>t[8]||(t[8]=[O("Final")]))),_:1}),Y(p,{value:3},{default:_((()=>t[9]||(t[9]=[O("Other")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),Y(m,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:_((()=>[I("table",A,[t[18]||(t[18]=I("thead",{class:"tblheader"},[I("tr",null,[I("th",null,"Employee Name"),I("th",null,"Action")])],-1)),I("tbody",null,[e.flogs.length>0?(k(!0),C(V,{key:0},M(e.flogs,((a,l)=>(k(),C("tr",{key:l},[I("td",null,B(a.fullName),1),I("td",E,[Y(p,{size:"small",density:"compact",color:"secondary",class:"my-2",id:"open-modal-"+l,onClick:t=>e.getDtr(a.username)},{default:_((()=>t[10]||(t[10]=[O("View")]))),_:2},1032,["id","onClick"]),Y(q,{ref_for:!0,ref:"modal"+l,trigger:"open-modal-"+l},{default:_((()=>[Y(d,null,{default:_((()=>[Y(i,null,{default:_((()=>[Y(h,{slot:"start"},{default:_((()=>[Y(g,{onClick:e.close},{default:_((()=>t[11]||(t[11]=[O("Cancel")]))),_:1},8,["onClick"])])),_:1}),Y(o,{class:"mr-12 text-center"},{default:_((()=>t[12]||(t[12]=[O("DTR REPORT")]))),_:1})])),_:1})])),_:1}),Y(Z,{class:"ion-padding"},{default:_((()=>[Y(o,{class:"pa-5 pb-0"},{default:_((()=>[I("div",null,B(a.fullName),1),I("div",P,B(e.logs.find((e=>e.username==a.username)).DEP_DESC),1),I("div",R,B(e.logs.find((e=>e.username==a.username)).posdesc),1)])),_:2},1024),Y(X,null,{default:_((()=>[e.dtr.length>0?(k(),b(T,{key:0,"model-value":0,elevation:"1",focusable:""},{default:_((()=>[(k(!0),C(V,null,M(e.dtr,(a=>(k(),b(x,null,{default:_((()=>[Y(v,{class:"font-weight-medium"},{default:_((()=>[O(B(a.date),1)])),_:2},1024),Y(y,null,{default:_((()=>[I("table",U,[t[16]||(t[16]=I("thead",null,[I("tr",null,[I("th",null,"TIME IN"),I("th",null,"TIME OUT")])],-1)),I("tbody",null,[(k(!0),C(V,null,M(a.data,(a=>(k(),C(V,null,[I("tr",null,[I("td",F,[O(B(a.trxtime)+" ",1),Boolean(a.pathname)||Boolean(a.latitude)&&Boolean(a.longitude)?(k(),b(w,{key:0,color:"blue-darken-4",onClick:t=>e.viewImage(a)},{default:_((()=>t[13]||(t[13]=[O("mdi-eye")]))),_:2},1032,["onClick"])):N("",!0)]),I("td",J,[O(B(a.trxOut?a.trxOut:"--:--:--")+" ",1),Boolean(a.trxOutData.pathname)||Boolean(a.trxOutData.latitude)&&Boolean(a.trxOutData.longitude)?(k(),b(w,{key:0,color:"blue-darken-4",onClick:t=>e.viewImage(a.trxOutData)},{default:_((()=>t[14]||(t[14]=[O("mdi-eye")]))),_:2},1032,["onClick"])):N("",!0)])]),I("tr",null,[I("td",$,[t[15]||(t[15]=I("span",{class:"font-weight-medium"},"Remark: ",-1)),I("span",null,B(a.remark),1)])])],64)))),256))])])])),_:2},1024)])),_:2},1024)))),256))])),_:1})):N("",!0)])),_:1})])),_:2},1024)])),_:2},1032,["trigger"])])])))),128)):(k(),C("tr",j,t[17]||(t[17]=[I("td",{colspan:"3",class:"text-red"},"No data found.",-1)])))])])])),_:1})])),_:1})])),_:1},8,["width"])])),_:1}),Y(le,{modelValue:e.dialog.status,"onUpdate:modelValue":t[5]||(t[5]=t=>e.dialog.status=t),opacity:"0.8",width:e.isMobile?"":"45%"},{default:_((()=>[Y(ae,null,{default:_((()=>[Y(te,{class:S(e.dialog.src?"pb-5":"")},{default:_((()=>[I("table",null,[I("tbody",null,[I("tr",null,[I("td",H,B(e.dialog.data.trxdate),1)]),I("tr",null,[I("td",z,B(1==e.dialog.data.trxmode?"Time Out":"Time In")+":",1),I("td",null,B(e.dialog.data.trxtime),1)]),I("tr",null,[t[19]||(t[19]=I("td",{class:"font-weight-medium"},"Location:",-1)),I("td",null,B(e.dialog.data.display_name),1)]),I("tr",null,[I("td",G,[e.dialog.src?(k(),C(V,{key:0},[e.isMobile?(k(),C("div",W,[Y(ee,{"aspect-ratio":1,class:"bg-surface elevation-10",src:e.dialog.src,contain:"",cover:""},null,8,["src"])])):(k(),C("div",Q,[Y(ee,{src:`${e.dialog.src}`,contain:""},null,8,["src"])]))],64)):N("",!0)])])])])])),_:1},8,["class"])])),_:1})])),_:1},8,["modelValue","width"])])),_:1})}],["__scopeId","data-v-6fc99143"]]))}}}));
