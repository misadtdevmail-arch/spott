System.register(["./index-legacy-CElZ_CId.js"],(function(t,e){"use strict";var a,l,n,o,s,i,d,r,u,c,m,p,g,f,h,v,w,y,x,b,_,D,k,Y,I,L,C,O,V,M,N,B;return{setters:[t=>{a=t.a,l=t.O,n=t.N,o=t.M,s=t.ad,i=t.S,d=t.Q,r=t.I,u=t.R,c=t.c,m=t.l,p=t.U,g=t.P,f=t.a1,h=t.V,v=t.i,w=t.X,y=t._,x=t.g,b=t.w,_=t.r,D=t.o,k=t.h,Y=t.k,I=t.ab,L=t.m,C=t.Y,O=t.Z,V=t.ac,M=t.t,N=t.C,B=t.F}],execute:function(){var e=document.createElement("style");e.textContent=".tblheader[data-v-d3d0809b]{background-color:#0d47a1;color:#fff}.label[data-v-d3d0809b]{min-width:50px}\n",document.head.appendChild(e);const S=a({components:{IonPage:c,IonHeader:u,IonTitle:r,IonToolbar:d,IonContent:i,IonModal:s,IonItem:o,IonButton:n,IonButtons:l},data:()=>({menu:!1,dialog:{status:!1,src:null,data:null},date:[],logs:[],approvalLevel:[],moment:f,search:"",dtr:[],rawdtr:[],backHandler:null}),computed:{getDate(){let t=this.date;if(1==t.length)return f(t[0]).format("L");if(t.length>1){let e=t[0],a=t[t.length-1];return f(e).format("L")+" - "+f(a).format("L")}return this.setDefaultDate(),null},flogs(){let t=this.logs;if(this.approvalLevel.length>0&&(t=t.filter((t=>this.approvalLevel.includes(parseInt(t.approvalLevel))))),this.search){let e=this.search.trim();t=t.filter((t=>t.fullName.toLowerCase().includes(e.toLowerCase())))}return t.length>0&&(t=[...new Set(t.map((t=>{const{username:e,fullName:a}=t;return JSON.stringify({username:e,fullName:a})})))].map((t=>JSON.parse(t))),t.sort(((t,e)=>t.fullName.localeCompare(e.fullName)))),t}},async ionViewWillEnter(){this.setDefaultDate(),await this.getLogs(),w(200,(t=>{this.dialog.status?this.dialog.status=!1:t()}))},methods:{setDefaultDate(){const t=[];for(let e=15;e>=0;e--){const a=f().subtract(e,"days").format("L");t.push(a)}this.date=t},selectDate:async function(){this.date.length>1&&(await this.getLogs(),this.menu=!1)},async getLogs(){this.logs=[];const{value:t}=await g.get({key:"userinfo"}),e=JSON.parse(t||"");if(v.value){const t=await m.create({message:"Fetching attendance logs, please wait..",translucent:!0,spinner:"lines"});await t.present();try{const{data:a}=await this.$api.getLogs({method:"post",data:{username:e.username,from:f(this.date[0]).format("YYYYY-MM-DD"),to:f(this.date[this.date.length-1]).format("YYYYY-MM-DD")}});a.length>0&&(this.logs=a),await t.dismiss()}catch(a){await t.dismiss(),alert(a)}}},async close(){await h.dismiss()},async getDtr(t){const{value:e}=await g.get({key:"userinfo"}),a=JSON.parse(e||""),l=await m.create({message:"Fetching employee dtr..",translucent:!0,spinner:"lines"});try{await l.present();let{data:e}=await this.$api.getDtr({method:"post",data:{username:t,from:f(this.date[0]).format("YYYYY-MM-DD"),to:f(this.date[this.date.length-1]).format("YYYYY-MM-DD"),isLive:a.isLive}});if(e.length>0){const t=e.filter((t=>0==t.trxmode)),a=e.filter((t=>1==t.trxmode)),l=t.map(((t,e)=>(null==a[e]?(t.trxOut=null,t.trxOutData={}):(t.trxOut=a[e].trxtime,t.trxOutData=a[e]),t)));this.dtr=[...new Set(e.map((t=>t.trxdate)))].map((t=>({date:t,data:l.filter((e=>e.trxdate==t))}))),this.dtr.sort(((t,e)=>e.date.localeCompare(t.date))),this.rawdtr=e}await l.dismiss()}catch(n){await l.dismiss(),alert(n)}},async viewImage(t){this.dialog.src=null,this.dialog.data=null;const e=await m.create({message:"Loading image, please wait..",translucent:!0,spinner:"lines"});await e.present();try{if(Boolean(t.pathname)){const{data:e}=await this.$api.viewFile({method:"post",data:{pathname:t.pathname}});e&&(this.dialog.src=e)}if(Boolean(t.latitude)&&Boolean(t.longitude)){const{data:e}=await p.get({url:"https://nominatim.openstreetmap.org/reverse",params:{format:"json",lat:t.latitude,lon:t.longitude},headers:{"User-Agent":"spott/1.2.30 (misadtdevmail@gmail.com)",Accept:"application/json"}});t.display_name=e.display_name,this.dialog.data=t}}catch(a){await e.dismiss(),alert(a)}finally{await e.dismiss(),(Boolean(this.dialog.src)||Boolean(this.dialog.data))&&(this.dialog.status=!0)}}}}),T={width:"100%",border:"1",class:"text-center"},E={width:"20%"},U={class:"text-body-1"},R={class:"text-body-1"},F={border:"",width:"100%"},P={align:"center"},A={class:"text-center"},J={colspan:"2",class:"px-1"},j={key:1},$={class:"font-weight-bold"},H={class:"font-weight-medium"},z={key:0,style:{height:"400px",position:"relative"}},Q={key:1};t("default",y(S,[["render",function(t,e,a,l,n,o){const s=_("ion-title"),i=_("ion-toolbar"),d=_("ion-header"),r=_("v-text-field"),u=_("v-date-picker"),c=_("v-menu"),m=_("v-col"),p=_("v-btn"),g=_("v-btn-toggle"),f=_("ion-button"),h=_("ion-buttons"),v=_("v-expansion-panel-title"),w=_("v-icon"),y=_("v-expansion-panel-text"),S=_("v-expansion-panel"),W=_("v-expansion-panels"),X=_("v-container"),Z=_("ion-content"),q=_("ion-modal"),G=_("v-row"),K=_("v-card-text"),tt=_("v-img"),et=_("v-card"),at=_("v-dialog"),lt=_("ion-page");return D(),x(lt,null,{default:b((()=>[k(d,{collapse:"fade"},{default:b((()=>[k(i,null,{default:b((()=>[k(s,null,{default:b((()=>e[6]||(e[6]=[Y("span",{class:"ml-4"},"DTR REPORT",-1)]))),_:1})])),_:1})])),_:1}),k(Z,null,{default:b((()=>[k(X,{fluid:"",class:"mx-auto px-3",width:"web"!=t.platform||t.isMobile?"":"50%"},{default:b((()=>[k(G,{class:"pa-0 ma-0 mb-3"},{default:b((()=>[k(m,{cols:"12",class:"pa-0 px-1 ma-0"},{default:b((()=>[k(c,{modelValue:t.menu,"onUpdate:modelValue":e[2]||(e[2]=e=>t.menu=e),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"350",location:"center","open-on-click":!1,persistent:!Boolean(t.date.length>1)},{activator:b((({props:a})=>[k(r,I({"model-value":t.getDate,label:"Select date range","prepend-inner-icon":"mdi-calendar-range",variant:"outlined",density:"compact",readonly:""},a,{class:"text-black font-weight-medium custom-label",onClick:e[0]||(e[0]=e=>t.menu=!0),"hide-details":""}),null,16,["model-value"])])),default:b((()=>[k(u,{modelValue:t.date,"onUpdate:modelValue":[e[1]||(e[1]=e=>t.date=e),t.selectDate],multiple:"range",color:"blue-darken-4",max:t.moment().format("YYYY-MM-DD"),range:!0},null,8,["modelValue","max","onUpdate:modelValue"])])),_:1},8,["modelValue","persistent"])])),_:1}),k(m,{cols:"12",class:"pa-0 px-1 ma-0 mt-2"},{default:b((()=>[k(r,{modelValue:t.search,"onUpdate:modelValue":e[3]||(e[3]=e=>t.search=e),label:"Search employee",variant:"outlined",density:"compact","hide-details":"",placeholder:"Enter employee name",clearable:""},null,8,["modelValue"])])),_:1}),k(m,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:b((()=>[k(g,{modelValue:t.approvalLevel,"onUpdate:modelValue":e[4]||(e[4]=e=>t.approvalLevel=e),multiple:"",density:"compact",color:"#0D47A1",border:""},{default:b((()=>[k(p,{value:1},{default:b((()=>e[7]||(e[7]=[L("Initial")]))),_:1}),k(p,{value:2},{default:b((()=>e[8]||(e[8]=[L("Final")]))),_:1})])),_:1},8,["modelValue"])])),_:1}),k(m,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:b((()=>[Y("table",T,[e[17]||(e[17]=Y("thead",{class:"tblheader"},[Y("tr",null,[Y("th",null,"Employee Name"),Y("th",null,"Action")])],-1)),Y("tbody",null,[t.flogs.length>0?(D(!0),C(O,{key:0},V(t.flogs,((a,l)=>(D(),C("tr",{key:l},[Y("td",null,M(a.fullName),1),Y("td",E,[k(p,{size:"small",density:"compact",color:"secondary",class:"my-2",id:"open-modal-"+l,onClick:e=>t.getDtr(a.username)},{default:b((()=>e[9]||(e[9]=[L("View")]))),_:2},1032,["id","onClick"]),k(q,{ref_for:!0,ref:"modal"+l,trigger:"open-modal-"+l},{default:b((()=>[k(d,null,{default:b((()=>[k(i,null,{default:b((()=>[k(h,{slot:"start"},{default:b((()=>[k(f,{onClick:t.close},{default:b((()=>e[10]||(e[10]=[L("Cancel")]))),_:1},8,["onClick"])])),_:1}),k(s,{class:"mr-12 text-center"},{default:b((()=>e[11]||(e[11]=[L("DTR REPORT")]))),_:1})])),_:1})])),_:1}),k(Z,{class:"ion-padding"},{default:b((()=>[k(s,{class:"pa-5 pb-0"},{default:b((()=>[Y("div",null,M(a.fullName),1),Y("div",U,M(t.logs.find((t=>t.username==a.username)).DEP_DESC),1),Y("div",R,M(t.logs.find((t=>t.username==a.username)).posdesc),1)])),_:2},1024),k(X,null,{default:b((()=>[t.dtr.length>0?(D(),x(W,{key:0,"model-value":0,elevation:"1",focusable:""},{default:b((()=>[(D(!0),C(O,null,V(t.dtr,(a=>(D(),x(S,null,{default:b((()=>[k(v,{class:"font-weight-medium"},{default:b((()=>[L(M(a.date),1)])),_:2},1024),k(y,null,{default:b((()=>[Y("table",F,[e[15]||(e[15]=Y("thead",null,[Y("tr",null,[Y("th",null,"TIME IN"),Y("th",null,"TIME OUT")])],-1)),Y("tbody",null,[(D(!0),C(O,null,V(a.data,(a=>(D(),C(O,null,[Y("tr",null,[Y("td",P,[L(M(a.trxtime)+" ",1),Boolean(a.pathname)||Boolean(a.latitude)&&Boolean(a.longitude)?(D(),x(w,{key:0,color:"blue-darken-4",onClick:e=>t.viewImage(a)},{default:b((()=>e[12]||(e[12]=[L("mdi-eye")]))),_:2},1032,["onClick"])):N("",!0)]),Y("td",A,[L(M(a.trxOut?a.trxOut:"--:--:--")+" ",1),Boolean(a.trxOutData.pathname)||Boolean(a.trxOutData.latitude)&&Boolean(a.trxOutData.longitude)?(D(),x(w,{key:0,color:"blue-darken-4",onClick:e=>t.viewImage(a.trxOutData)},{default:b((()=>e[13]||(e[13]=[L("mdi-eye")]))),_:2},1032,["onClick"])):N("",!0)])]),Y("tr",null,[Y("td",J,[e[14]||(e[14]=Y("span",{class:"font-weight-medium"},"Remark: ",-1)),Y("span",null,M(a.remark),1)])])],64)))),256))])])])),_:2},1024)])),_:2},1024)))),256))])),_:1})):N("",!0)])),_:1})])),_:2},1024)])),_:2},1032,["trigger"])])])))),128)):(D(),C("tr",j,e[16]||(e[16]=[Y("td",{colspan:"3",class:"text-red"},"No data found.",-1)])))])])])),_:1})])),_:1})])),_:1},8,["width"])])),_:1}),k(at,{modelValue:t.dialog.status,"onUpdate:modelValue":e[5]||(e[5]=e=>t.dialog.status=e),opacity:"0.8",width:t.isMobile?"":"45%"},{default:b((()=>[k(et,null,{default:b((()=>[k(K,{class:B(t.dialog.src?"pb-2":"")},{default:b((()=>[Y("table",null,[Y("tbody",null,[Y("tr",null,[Y("td",$,M(t.dialog.data.trxdate),1)]),Y("tr",null,[Y("td",H,M(1==t.dialog.data.trxmode?"Time Out":"Time In")+":",1),Y("td",null,M(t.dialog.data.trxtime),1)]),Y("tr",null,[e[18]||(e[18]=Y("td",{class:"font-weight-medium"},"Location:",-1)),Y("td",null,M(t.dialog.data.display_name),1)])])])])),_:1},8,["class"]),t.dialog.src?(D(),C(O,{key:0},[t.isMobile?(D(),C("div",Q,[k(tt,{"aspect-ratio":1,class:"bg-surface elevation-10",src:t.dialog.src,cover:"",contain:""},null,8,["src"])])):(D(),C("div",z,[k(tt,{src:t.dialog.src,contain:""},null,8,["src"])]))],64)):N("",!0)])),_:1})])),_:1},8,["modelValue","width"])])),_:1})}],["__scopeId","data-v-d3d0809b"]]))}}}));
