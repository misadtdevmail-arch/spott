import{a as Z,Q as q,O as K,N as tt,ac as et,T as at,R as nt,I as lt,S as ot,c as st,l as O,V as it,P as T,a1 as _,X as rt,i as dt,f as ut,Y as mt,_ as pt,g as y,w as a,r as o,o as d,h as l,m as n,ab as ct,k as c,B as v,F as D,C as B,t as m,Z as V,G as ft}from"./index-CVlYEBNf.js";const gt=Z({components:{IonPage:st,IonHeader:ot,IonTitle:lt,IonToolbar:nt,IonContent:at,IonModal:et,IonItem:tt,IonButton:K,IonButtons:q},data(){return{menu:!1,dialog:{status:!1,src:null,data:null},date:[],logs:[],approvalLevel:[],moment:_,search:"",dtr:[],rawdtr:[],backHandler:null}},computed:{getDate(){let t=this.date;if(t.length==1)return _(t[0]).format("L");if(t.length>1){let e=t[0],s=t[t.length-1];return _(e).format("L")+" - "+_(s).format("L")}else return this.setDefaultDate(),null},flogs(){let t=this.logs;if(this.approvalLevel.length>0&&(t=t.filter(e=>this.approvalLevel.includes(parseInt(e.approvalLevel)))),this.search){let e=this.search.trim();t=t.filter(s=>s.fullName.toLowerCase().includes(e.toLowerCase()))}return t.length>0&&(t=[...new Set(t.map(e=>{const{username:s,fullName:p}=e;return JSON.stringify({username:s,fullName:p})}))].map(e=>JSON.parse(e)),t.sort((e,s)=>e.fullName.localeCompare(s.fullName))),t}},async ionViewWillEnter(){this.setDefaultDate(),await this.getLogs(),mt(200,t=>{if(this.dialog.status){this.dialog.status=!1;return}t()})},methods:{setDefaultDate(){const t=[];for(let e=15;e>=0;e--){const s=_().subtract(e,"days").format("L");t.push(s)}this.date=t},selectDate:async function(){this.date.length>1&&(await this.getLogs(),this.menu=!1)},async getLogs(){this.logs=[];const{value:t}=await T.get({key:"userinfo"}),e=JSON.parse(t||"");if(dt.value){const s=await O.create({message:"Fetching attendance logs, please wait..",translucent:!0,spinner:"lines"});await s.present();try{const{data:p}=await this.$api.getLogs({method:"post",data:{username:e.username,initialApp:e.initialApp,finalApp:e.finalApp,deptListAccess:e.departmentAccess,from:_(this.date[0]).format("YYYYY-MM-DD"),to:_(this.date[this.date.length-1]).format("YYYYY-MM-DD")}});p.length>0&&(this.logs=p),await s.dismiss()}catch(p){await s.dismiss(),alert(p)}}else await(await ut.create({header:"System Alert!",message:"Please ensure you have a stable internet connection.",backdropDismiss:!1,buttons:["Okay"]})).present()},async close(){await rt.dismiss()},async getDtr(t){const{value:e}=await T.get({key:"userinfo"}),s=JSON.parse(e||""),p=await O.create({message:"Fetching employee dtr..",translucent:!0,spinner:"lines"});try{await p.present();let{data:g}=await this.$api.getDtr({method:"post",data:{username:t,from:_(this.date[0]).format("YYYYY-MM-DD"),to:_(this.date[this.date.length-1]).format("YYYYY-MM-DD"),isLive:s.isLive}});if(g.length>0){g[0].trxmode==1&&g.splice(0,1);const L=g.filter(i=>i.trxmode==0),h=g.filter(i=>i.trxmode==1),k=L.map((i,f)=>(h[f]==null?(i.trxOut=null,i.trxOutData={}):(i.trxOut=h[f].trxtime,i.trxOutData=h[f]),i));this.dtr=[...new Set(L.map(i=>i.trxdate))].map(i=>({date:i,data:k.filter(f=>f.trxdate==i)})),this.dtr.sort((i,f)=>f.date.localeCompare(i.date)),this.rawdtr=g}await p.dismiss()}catch(g){await p.dismiss(),alert(g)}},async viewImage(t){this.dialog.src=null,this.dialog.data=null;const e=await O.create({message:"Loading image, please wait..",translucent:!0,spinner:"lines"});await e.present();try{if(t.pathname){const{data:s}=await this.$api.viewFile({method:"post",data:{pathname:t.pathname}});s&&(this.dialog.src=s)}if(t.latitude&&t.longitude){const{data:s}=await it.get({url:"https://nominatim.openstreetmap.org/reverse",params:{format:"json",lat:t.latitude,lon:t.longitude},headers:{"User-Agent":"spott/1.2.30 (misadtdevmail@gmail.com)",Accept:"application/json"}});t.display_name=s.display_name,this.dialog.data=t}}catch(s){await e.dismiss(),alert(s)}finally{await e.dismiss(),(this.dialog.src||this.dialog.data)&&(this.dialog.status=!0)}}}}),_t={width:"100%",border:"1",class:"text-center"},vt={width:"20%"},ht={class:"text-body-1"},wt={class:"text-body-1"},bt={border:"",width:"100%"},yt={align:"center"},Dt={class:"text-center"},kt={colspan:"2",class:"px-1"},Ct={key:1},Yt={class:"font-weight-bold"},Vt={class:"font-weight-medium"},Lt={key:0,style:{height:"400px",position:"relative"}},Ot={key:1};function Bt(t,e,s,p,g,L){const h=o("ion-title"),k=o("ion-toolbar"),i=o("ion-header"),f=o("v-text-field"),A=o("v-date-picker"),S=o("v-menu"),C=o("v-col"),Y=o("v-btn"),$=o("v-btn-toggle"),E=o("ion-button"),R=o("ion-buttons"),P=o("v-expansion-panel-title"),I=o("v-icon"),U=o("v-expansion-panel-text"),F=o("v-expansion-panel"),J=o("v-expansion-panels"),x=o("v-container"),N=o("ion-content"),H=o("ion-modal"),j=o("v-row"),z=o("v-card-text"),M=o("v-img"),G=o("v-card"),Q=o("v-dialog"),W=o("ion-page");return d(),y(W,null,{default:a(()=>[l(i,{collapse:"fade"},{default:a(()=>[l(k,null,{default:a(()=>[l(h,null,{default:a(()=>e[6]||(e[6]=[n("span",{class:"ml-4"},"DTR REPORT",-1)])),_:1})]),_:1})]),_:1}),l(N,null,{default:a(()=>[l(x,{fluid:"",class:"mx-auto px-3",width:t.platform=="web"&&!t.isMobile?"50%":""},{default:a(()=>[l(j,{class:"pa-0 ma-0 mb-3"},{default:a(()=>[l(C,{cols:"12",class:"pa-0 px-1 ma-0"},{default:a(()=>[l(S,{modelValue:t.menu,"onUpdate:modelValue":e[2]||(e[2]=r=>t.menu=r),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"350",location:"center","open-on-click":!1,persistent:!(t.date.length>1)},{activator:a(({props:r})=>[l(f,ct({"model-value":t.getDate,label:"Select date range","prepend-inner-icon":"mdi-calendar-range",variant:"outlined",density:"compact",readonly:""},r,{class:"text-black font-weight-medium custom-label",onClick:e[0]||(e[0]=b=>t.menu=!0),"hide-details":""}),null,16,["model-value"])]),default:a(()=>[l(A,{modelValue:t.date,"onUpdate:modelValue":[e[1]||(e[1]=r=>t.date=r),t.selectDate],multiple:"range",color:"blue-darken-4",max:t.moment().format("YYYY-MM-DD"),range:!0},null,8,["modelValue","max","onUpdate:modelValue"])]),_:1},8,["modelValue","persistent"])]),_:1}),l(C,{cols:"12",class:"pa-0 px-1 ma-0 mt-2"},{default:a(()=>[l(f,{modelValue:t.search,"onUpdate:modelValue":e[3]||(e[3]=r=>t.search=r),label:"Search employee",variant:"outlined",density:"compact","hide-details":"",placeholder:"Enter employee name",clearable:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:a(()=>[l($,{modelValue:t.approvalLevel,"onUpdate:modelValue":e[4]||(e[4]=r=>t.approvalLevel=r),multiple:"",density:"compact",color:"#0D47A1",border:""},{default:a(()=>[l(Y,{value:1},{default:a(()=>e[7]||(e[7]=[c("Initial")])),_:1}),l(Y,{value:2},{default:a(()=>e[8]||(e[8]=[c("Final")])),_:1}),l(Y,{value:3},{default:a(()=>e[9]||(e[9]=[c("Other")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(C,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:a(()=>[n("table",_t,[e[18]||(e[18]=n("thead",{class:"tblheader"},[n("tr",null,[n("th",null,"Employee Name"),n("th",null,"Action")])],-1)),n("tbody",null,[t.flogs.length>0?(d(!0),v(D,{key:0},B(t.flogs,(r,b)=>(d(),v("tr",{key:b},[n("td",null,m(r.fullName),1),n("td",vt,[l(Y,{size:"small",density:"compact",color:"secondary",class:"my-2",id:"open-modal-"+b,onClick:w=>t.getDtr(r.username)},{default:a(()=>e[10]||(e[10]=[c("View")])),_:2},1032,["id","onClick"]),l(H,{ref_for:!0,ref:"modal"+b,trigger:"open-modal-"+b},{default:a(()=>[l(i,null,{default:a(()=>[l(k,null,{default:a(()=>[l(R,{slot:"start"},{default:a(()=>[l(E,{onClick:t.close},{default:a(()=>e[11]||(e[11]=[c("Cancel")])),_:1},8,["onClick"])]),_:1}),l(h,{class:"mr-12 text-center"},{default:a(()=>e[12]||(e[12]=[c("DTR REPORT")])),_:1})]),_:1})]),_:1}),l(N,{class:"ion-padding"},{default:a(()=>[l(h,{class:"pa-5 pb-0"},{default:a(()=>[n("div",null,m(r.fullName),1),n("div",ht,m(t.logs.find(w=>w.username==r.username).DEP_DESC),1),n("div",wt,m(t.logs.find(w=>w.username==r.username).posdesc),1)]),_:2},1024),l(x,null,{default:a(()=>[t.dtr.length>0?(d(),y(J,{key:0,"model-value":0,elevation:"1",focusable:""},{default:a(()=>[(d(!0),v(D,null,B(t.dtr,w=>(d(),y(F,null,{default:a(()=>[l(P,{class:"font-weight-medium"},{default:a(()=>[c(m(w.date),1)]),_:2},1024),l(U,null,{default:a(()=>[n("table",bt,[e[16]||(e[16]=n("thead",null,[n("tr",null,[n("th",null,"TIME IN"),n("th",null,"TIME OUT")])],-1)),n("tbody",null,[(d(!0),v(D,null,B(w.data,u=>(d(),v(D,null,[n("tr",null,[n("td",yt,[c(m(u.trxtime)+" ",1),u.pathname||u.latitude&&u.longitude?(d(),y(I,{key:0,color:"blue-darken-4",onClick:X=>t.viewImage(u)},{default:a(()=>e[13]||(e[13]=[c("mdi-eye")])),_:2},1032,["onClick"])):V("",!0)]),n("td",Dt,[c(m(u.trxOut?u.trxOut:"--:--:--")+" ",1),u.trxOutData.pathname||u.trxOutData.latitude&&u.trxOutData.longitude?(d(),y(I,{key:0,color:"blue-darken-4",onClick:X=>t.viewImage(u.trxOutData)},{default:a(()=>e[14]||(e[14]=[c("mdi-eye")])),_:2},1032,["onClick"])):V("",!0)])]),n("tr",null,[n("td",kt,[e[15]||(e[15]=n("span",{class:"font-weight-medium"},"Remark: ",-1)),n("span",null,m(u.remark),1)])])],64))),256))])])]),_:2},1024)]),_:2},1024))),256))]),_:1})):V("",!0)]),_:1})]),_:2},1024)]),_:2},1032,["trigger"])])]))),128)):(d(),v("tr",Ct,e[17]||(e[17]=[n("td",{colspan:"3",class:"text-red"},"No data found.",-1)])))])])]),_:1})]),_:1})]),_:1},8,["width"])]),_:1}),l(Q,{modelValue:t.dialog.status,"onUpdate:modelValue":e[5]||(e[5]=r=>t.dialog.status=r),opacity:"0.8",width:t.isMobile?"":"45%"},{default:a(()=>[l(G,null,{default:a(()=>[l(z,{class:ft(t.dialog.src?"pb-2":"")},{default:a(()=>[n("table",null,[n("tbody",null,[n("tr",null,[n("td",Yt,m(t.dialog.data.trxdate),1)]),n("tr",null,[n("td",Vt,m(t.dialog.data.trxmode==1?"Time Out":"Time In")+":",1),n("td",null,m(t.dialog.data.trxtime),1)]),n("tr",null,[e[19]||(e[19]=n("td",{class:"font-weight-medium"},"Location:",-1)),n("td",null,m(t.dialog.data.display_name),1)])])])]),_:1},8,["class"]),t.dialog.src?(d(),v(D,{key:0},[t.isMobile?(d(),v("div",Ot,[l(M,{"aspect-ratio":1,class:"bg-surface elevation-10",src:t.dialog.src,cover:"",contain:""},null,8,["src"])])):(d(),v("div",Lt,[l(M,{src:t.dialog.src,contain:""},null,8,["src"])]))],64)):V("",!0)]),_:1})]),_:1},8,["modelValue","width"])]),_:1})}const xt=pt(gt,[["render",Bt],["__scopeId","data-v-2744f2ed"]]);export{xt as default};
