import{a as q,O as G,N as K,M as tt,ad as et,S as at,Q as nt,I as lt,R as ot,c as st,l as I,U as it,P as T,a1 as g,V as dt,i as rt,X as ut,_ as mt,g as y,w as n,r as o,o as r,h as l,k as a,ab as pt,m as f,Y as _,Z as D,ac as L,t as m,C as Y,F as ct}from"./index-i7MoSKnM.js";const ft=q({components:{IonPage:st,IonHeader:ot,IonTitle:lt,IonToolbar:nt,IonContent:at,IonModal:et,IonItem:tt,IonButton:K,IonButtons:G},data(){return{menu:!1,dialog:{status:!1,src:null,data:null},date:[],logs:[],approvalLevel:[],moment:g,search:"",dtr:[],rawdtr:[],backHandler:null}},computed:{getDate(){let t=this.date;if(t.length==1)return g(t[0]).format("L");if(t.length>1){let e=t[0],s=t[t.length-1];return g(e).format("L")+" - "+g(s).format("L")}else return this.setDefaultDate(),null},flogs(){let t=this.logs;if(this.approvalLevel.length>0&&(t=t.filter(e=>this.approvalLevel.includes(parseInt(e.approvalLevel)))),this.search){let e=this.search.trim();t=t.filter(s=>s.fullName.toLowerCase().includes(e.toLowerCase()))}return t.length>0&&(t=[...new Set(t.map(e=>{const{username:s,fullName:p}=e;return JSON.stringify({username:s,fullName:p})}))].map(e=>JSON.parse(e)),t.sort((e,s)=>e.fullName.localeCompare(s.fullName))),t}},async ionViewWillEnter(){this.setDefaultDate(),await this.getLogs(),ut(200,t=>{if(this.dialog.status){this.dialog.status=!1;return}t()})},methods:{setDefaultDate(){const t=[];for(let e=15;e>=0;e--){const s=g().subtract(e,"days").format("L");t.push(s)}this.date=t},selectDate:async function(){this.date.length>1&&(await this.getLogs(),this.menu=!1)},async getLogs(){this.logs=[];const{value:t}=await T.get({key:"userinfo"}),e=JSON.parse(t||"");if(rt.value){const s=await I.create({message:"Fetching attendance logs, please wait..",translucent:!0,spinner:"lines"});await s.present();try{const{data:p}=await this.$api.getLogs({method:"post",data:{username:e.username,from:g(this.date[0]).format("YYYYY-MM-DD"),to:g(this.date[this.date.length-1]).format("YYYYY-MM-DD")}});p.length>0&&(this.logs=p),await s.dismiss()}catch(p){await s.dismiss(),alert(p)}}},async close(){await dt.dismiss()},async getDtr(t){const{value:e}=await T.get({key:"userinfo"}),s=JSON.parse(e||""),p=await I.create({message:"Fetching employee dtr..",translucent:!0,spinner:"lines"});try{await p.present();let{data:h}=await this.$api.getDtr({method:"post",data:{username:t,from:g(this.date[0]).format("YYYYY-MM-DD"),to:g(this.date[this.date.length-1]).format("YYYYY-MM-DD"),isLive:s.isLive}});if(h.length>0){const B=h.filter(i=>i.trxmode==0),v=h.filter(i=>i.trxmode==1),k=B.map((i,c)=>(v[c]==null?(i.trxOut=null,i.trxOutData={}):(i.trxOut=v[c].trxtime,i.trxOutData=v[c]),i));this.dtr=[...new Set(h.map(i=>i.trxdate))].map(i=>({date:i,data:k.filter(c=>c.trxdate==i)})),this.dtr.sort((i,c)=>c.date.localeCompare(i.date)),this.rawdtr=h}await p.dismiss()}catch(h){await p.dismiss(),alert(h)}},async viewImage(t){this.dialog.src=null,this.dialog.data=null;const e=await I.create({message:"Loading image, please wait..",translucent:!0,spinner:"lines"});await e.present();try{if(t.pathname){const{data:s}=await this.$api.viewFile({method:"post",data:{pathname:t.pathname}});s&&(this.dialog.src=s)}if(t.latitude&&t.longitude){const{data:s}=await it.get({url:"https://nominatim.openstreetmap.org/reverse",params:{format:"json",lat:t.latitude,lon:t.longitude},headers:{"User-Agent":"spott/1.2.30 (misadtdevmail@gmail.com)",Accept:"application/json"}});t.display_name=s.display_name,this.dialog.data=t}}catch(s){await e.dismiss(),alert(s)}finally{await e.dismiss(),(this.dialog.src||this.dialog.data)&&(this.dialog.status=!0)}}}}),gt={width:"100%",border:"1",class:"text-center"},_t={width:"20%"},ht={class:"text-body-1"},vt={class:"text-body-1"},wt={border:"",width:"100%"},bt={align:"center"},yt={class:"text-center"},Dt={colspan:"2",class:"px-1"},kt={key:1},Ct={class:"font-weight-bold"},Yt={class:"font-weight-medium"},Vt={key:0,style:{height:"400px",position:"relative"}},It={key:1};function Lt(t,e,s,p,h,B){const v=o("ion-title"),k=o("ion-toolbar"),i=o("ion-header"),c=o("v-text-field"),S=o("v-date-picker"),$=o("v-menu"),C=o("v-col"),V=o("v-btn"),E=o("v-btn-toggle"),R=o("ion-button"),U=o("ion-buttons"),P=o("v-expansion-panel-title"),O=o("v-icon"),F=o("v-expansion-panel-text"),A=o("v-expansion-panel"),J=o("v-expansion-panels"),x=o("v-container"),N=o("ion-content"),H=o("ion-modal"),j=o("v-row"),z=o("v-card-text"),M=o("v-img"),Q=o("v-card"),W=o("v-dialog"),X=o("ion-page");return r(),y(X,null,{default:n(()=>[l(i,{collapse:"fade"},{default:n(()=>[l(k,null,{default:n(()=>[l(v,null,{default:n(()=>e[6]||(e[6]=[a("span",{class:"ml-4"},"DTR REPORT",-1)])),_:1})]),_:1})]),_:1}),l(N,null,{default:n(()=>[l(x,{fluid:"",class:"mx-auto px-3",width:t.platform=="web"&&!t.isMobile?"50%":""},{default:n(()=>[l(j,{class:"pa-0 ma-0 mb-3"},{default:n(()=>[l(C,{cols:"12",class:"pa-0 px-1 ma-0"},{default:n(()=>[l($,{modelValue:t.menu,"onUpdate:modelValue":e[2]||(e[2]=d=>t.menu=d),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","max-width":"350",location:"center","open-on-click":!1,persistent:!(t.date.length>1)},{activator:n(({props:d})=>[l(c,pt({"model-value":t.getDate,label:"Select date range","prepend-inner-icon":"mdi-calendar-range",variant:"outlined",density:"compact",readonly:""},d,{class:"text-black font-weight-medium custom-label",onClick:e[0]||(e[0]=b=>t.menu=!0),"hide-details":""}),null,16,["model-value"])]),default:n(()=>[l(S,{modelValue:t.date,"onUpdate:modelValue":[e[1]||(e[1]=d=>t.date=d),t.selectDate],multiple:"range",color:"blue-darken-4",max:t.moment().format("YYYY-MM-DD"),range:!0},null,8,["modelValue","max","onUpdate:modelValue"])]),_:1},8,["modelValue","persistent"])]),_:1}),l(C,{cols:"12",class:"pa-0 px-1 ma-0 mt-2"},{default:n(()=>[l(c,{modelValue:t.search,"onUpdate:modelValue":e[3]||(e[3]=d=>t.search=d),label:"Search employee",variant:"outlined",density:"compact","hide-details":"",placeholder:"Enter employee name",clearable:""},null,8,["modelValue"])]),_:1}),l(C,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:n(()=>[l(E,{modelValue:t.approvalLevel,"onUpdate:modelValue":e[4]||(e[4]=d=>t.approvalLevel=d),multiple:"",density:"compact",color:"#0D47A1",border:""},{default:n(()=>[l(V,{value:1},{default:n(()=>e[7]||(e[7]=[f("Initial")])),_:1}),l(V,{value:2},{default:n(()=>e[8]||(e[8]=[f("Final")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(C,{cols:"12",class:"pa-0 px-1 ma-0 mt-3"},{default:n(()=>[a("table",gt,[e[17]||(e[17]=a("thead",{class:"tblheader"},[a("tr",null,[a("th",null,"Employee Name"),a("th",null,"Action")])],-1)),a("tbody",null,[t.flogs.length>0?(r(!0),_(D,{key:0},L(t.flogs,(d,b)=>(r(),_("tr",{key:b},[a("td",null,m(d.fullName),1),a("td",_t,[l(V,{size:"small",density:"compact",color:"secondary",class:"my-2",id:"open-modal-"+b,onClick:w=>t.getDtr(d.username)},{default:n(()=>e[9]||(e[9]=[f("View")])),_:2},1032,["id","onClick"]),l(H,{ref_for:!0,ref:"modal"+b,trigger:"open-modal-"+b},{default:n(()=>[l(i,null,{default:n(()=>[l(k,null,{default:n(()=>[l(U,{slot:"start"},{default:n(()=>[l(R,{onClick:t.close},{default:n(()=>e[10]||(e[10]=[f("Cancel")])),_:1},8,["onClick"])]),_:1}),l(v,{class:"mr-12 text-center"},{default:n(()=>e[11]||(e[11]=[f("DTR REPORT")])),_:1})]),_:1})]),_:1}),l(N,{class:"ion-padding"},{default:n(()=>[l(v,{class:"pa-5 pb-0"},{default:n(()=>[a("div",null,m(d.fullName),1),a("div",ht,m(t.logs.find(w=>w.username==d.username).DEP_DESC),1),a("div",vt,m(t.logs.find(w=>w.username==d.username).posdesc),1)]),_:2},1024),l(x,null,{default:n(()=>[t.dtr.length>0?(r(),y(J,{key:0,"model-value":0,elevation:"1",focusable:""},{default:n(()=>[(r(!0),_(D,null,L(t.dtr,w=>(r(),y(A,null,{default:n(()=>[l(P,{class:"font-weight-medium"},{default:n(()=>[f(m(w.date),1)]),_:2},1024),l(F,null,{default:n(()=>[a("table",wt,[e[15]||(e[15]=a("thead",null,[a("tr",null,[a("th",null,"TIME IN"),a("th",null,"TIME OUT")])],-1)),a("tbody",null,[(r(!0),_(D,null,L(w.data,u=>(r(),_(D,null,[a("tr",null,[a("td",bt,[f(m(u.trxtime)+" ",1),u.pathname||u.latitude&&u.longitude?(r(),y(O,{key:0,color:"blue-darken-4",onClick:Z=>t.viewImage(u)},{default:n(()=>e[12]||(e[12]=[f("mdi-eye")])),_:2},1032,["onClick"])):Y("",!0)]),a("td",yt,[f(m(u.trxOut?u.trxOut:"--:--:--")+" ",1),u.trxOutData.pathname||u.trxOutData.latitude&&u.trxOutData.longitude?(r(),y(O,{key:0,color:"blue-darken-4",onClick:Z=>t.viewImage(u.trxOutData)},{default:n(()=>e[13]||(e[13]=[f("mdi-eye")])),_:2},1032,["onClick"])):Y("",!0)])]),a("tr",null,[a("td",Dt,[e[14]||(e[14]=a("span",{class:"font-weight-medium"},"Remark: ",-1)),a("span",null,m(u.remark),1)])])],64))),256))])])]),_:2},1024)]),_:2},1024))),256))]),_:1})):Y("",!0)]),_:1})]),_:2},1024)]),_:2},1032,["trigger"])])]))),128)):(r(),_("tr",kt,e[16]||(e[16]=[a("td",{colspan:"3",class:"text-red"},"No data found.",-1)])))])])]),_:1})]),_:1})]),_:1},8,["width"])]),_:1}),l(W,{modelValue:t.dialog.status,"onUpdate:modelValue":e[5]||(e[5]=d=>t.dialog.status=d),opacity:"0.8",width:t.isMobile?"":"45%"},{default:n(()=>[l(Q,null,{default:n(()=>[l(z,{class:ct(t.dialog.src?"pb-2":"")},{default:n(()=>[a("table",null,[a("tbody",null,[a("tr",null,[a("td",Ct,m(t.dialog.data.trxdate),1)]),a("tr",null,[a("td",Yt,m(t.dialog.data.trxmode==1?"Time Out":"Time In")+":",1),a("td",null,m(t.dialog.data.trxtime),1)]),a("tr",null,[e[18]||(e[18]=a("td",{class:"font-weight-medium"},"Location:",-1)),a("td",null,m(t.dialog.data.display_name),1)])])])]),_:1},8,["class"]),t.dialog.src?(r(),_(D,{key:0},[t.isMobile?(r(),_("div",It,[l(M,{"aspect-ratio":1,class:"bg-surface elevation-10",src:t.dialog.src,cover:"",contain:""},null,8,["src"])])):(r(),_("div",Vt,[l(M,{src:t.dialog.src,contain:""},null,8,["src"])]))],64)):Y("",!0)]),_:1})]),_:1},8,["modelValue","width"])]),_:1})}const Ot=mt(ft,[["render",Lt],["__scopeId","data-v-d3d0809b"]]);export{Ot as default};
